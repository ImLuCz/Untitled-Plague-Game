export const questions = [
  //1 domanda
  { question: 'In che anno arriva la peste a Firenze?',
    options: ['1248', '1350', '1348', '1340'],
    answer: '1348' },
  //2 domanda 
  { question: 'Quale di queste tipologie di peste non esiste?',
    options: ['Peste nera', 'Peste setticemica', 'Peste neurologica', 'Peste bubbonica'],
    answer: 'Peste neurologica' },
  //3 domanda 
  { question: 'Qual è la città più popolata negli anni del XIV secolo?',
    options: ['Parigi', 'Venezia', 'Milano', 'Firenze'],
    answer: 'Parigi' },
  //4 domanda
  { question: 'Quanti sono realmente i giorni che i ragazzi del Decameron hanno passato nella villa?',
    options: ['10', '12', '14', '13'],
    answer: '14' },
  //5 domanda
  { question: 'Quanti morti ha causato la peste a Firenze?',
    options: ['5000', 'Circa il 50% della popolazione', 'Oltre 300.000', 'Meno di 1000'],
    answer: 'Circa il 50% della popolazione' },
  //6 domanda
  { question: 'Quanti sono i ragazzi nella villa del Decameron?',
    options: ['8', '10', '12', '9'],
    answer: '10' },
  //7 domanda
  { question: 'Boccaccio da piccolo in che città si stabilisce?',
    options: ['Firenze', 'Milano', 'Palermo', 'Napoli'],
    answer: 'Napoli' },
  //8 domanda
  { question: 'Le autorità che restrizione misero dopo l\'arrivo della peste?',
    options: ['Quarantena', 'Uscire solo di sera', 'Uscire solo di giorno', 'Flagellarsi per la città'],
    answer: 'Quarantena' },
  //9 domanda
  { question: 'Chi furono incolpati per la diffusione della peste?',
    options: ['Gli spagnoli', 'I napoletani', 'Gli ungheresi', 'Gli ebrei'],
    answer: 'Gli ebrei' },
  //10 domanda
  { question: 'Dove nasce Boccaccio?',
    options: ['Avignone', 'Napoli', 'Milano', 'Non è sicuro'],
    answer: 'Non è sicuro' },
  //11 domanda
  { question: 'In che anno nasce Boccaccio?',
    options: ['1311', '1312', '1313', '1310'],
    answer: '1313' },
  //12 domanda
  { question: 'In che anno la peste inizia ad indebolirsi?',
    options: ['1351', '1348', '1352', '1360'],
    answer: '1351' },
  //13 domanda
  { question: 'In che secolo si afferma la corrente poetica dell\'umanesimo?',
    options: ['XII', 'XI', 'XVII', 'XV'],
    answer: 'XV' },
  //14 domanda
  { question: 'Cosa accade tra il 1315 e il 1317?',
    options: ['Crisi demografica', 'Crisi economica', 'Crisi di potere', 'Crisi agricola'],
    answer: 'Crisi agricola' },
  //15 domanda
  { question: 'Quale università fu fondata nel 1088?',
    options: ['Università di Pavia', 'Università di Bologna', 'Università di Milano', 'Università di Firenze'],
    answer: 'Università di Bologna' },
  //16 domanda
  { question: 'In che anno la sede papale fu spostata ad Avignone?',
    options: ['1310', '1340', '1307', '1309'],
    answer: '1309' },
  //17 domanda
  { question: 'In che anno finisce la cattività avignonese?',
    options: ['1380', '1377', '1367', '1370'],
    answer: '1377' },
  //18 domanda
  { question: 'Quando inizia la guerra dei Cent\'anni?',
    options: ['1337', '1340', '1333', '1335'],
    answer: '1337' },
  //19 domanda
  { question: 'Quando venne concluso il Decameron?',
    options: ['1350', '1343', '1353', '1363'],
    answer: '1353' },
  //20 domanda
  { question: 'Dove muore Boccaccio?',
    options: ['Verona', 'Firenze', 'Napoli', 'Certaldo'],
    answer: 'Certaldo' },
  //21 domanda
  { question: 'Cosa sono i lazzaretti?',
    options: [
      'Strutture di isolamento per persone affette da malattie contagiose',
      'Strutture religiose',
      'Grandi città con tanti malati',
      'Luogo di incontro per studiosi'
    ],
    answer: 'Strutture di isolamento per persone affette da malattie contagiose' },
  //22 domanda
  { question: 'Quale animale venne erroneamente sterminato perché si pensava fosse responsabile della Peste Nera?',
    options: ['Il gatto', 'Il cane', 'La tigre', 'Il cavallo'], 
    answer: 'Il gatto' },
  //23 domanda
    { question: 'Qual era la causa principale della diffusione della Peste Nera?', 
      options: ['L\'inquinamento', 'Le pulci sui ratti', 'Cibo avariato', 'Medicina medievale'], 
      answer: 'Le pulci sui ratti' },
  //24 domanda
  { question: 'Quale fu l\'origine geografica della Peste Nera prima di arrivare in Europa?', 
    options: ['Africa', 'Asia centrale', 'America del Nord', 'Oceania'], 
    answer: 'Asia centrale' },
  //25 domanda
  { question: 'Quale cambiamento economico fu causato dalla riduzione della popolazione dovuta alla peste?', 
    options: ['Aumento dei salari per i lavoratori', 'Crollo del commercio', 'Abolizione della proprietà terriera', 'Creazione di nuove città'], 
    answer: 'Aumento dei salari per i lavoratori' },
  //26 domanda 
  { question: 'Secondo le credenze del tempo la peste si diffonde anche per cosa?', 
    options: ['Per il contatto di acqua', 'Per il cattivo odore', 'Per via degli spagnoli','Per volere del papa'], 
    answer: 'Per il cattivo odore' },
  //27 domanda 
  { question: 'Quale gruppo sociale fu colpito più duramente dalle conseguenze economiche della Peste Nera?',
    options: ['Contadini', 'Mercanti', 'Nobili', 'Artigiani'],
    answer: 'Contadini' },
  //28 domanda
  { question: 'Che cosa sono le jacqueries?', 
  options: ['Strutture difensive', 'Eserciti di mercenari', 'Zone per malati', 'Insurrezioni contadine'], 
  answer: 'Insurrezioni contadine' },
  //29 domanda
  { question: 'Chi erano i Ciompi?', 
  options: ['Falegnami', 'Operai della lana', 'Operai della seta', 'Agricoltori'], 
  answer: 'Operai della lana' },
  //30 domanda
  { question: 'Quando finisce la guerra dei Cent\'anni?', 
  options: ['1443', '1453', '1437', '1441'], 
  answer: '1453' },
  //31 domanda
  { question: 'Chi vinse la guerra dei Cent\'anni?', 
  options: ['Inghilterra', 'Italia', 'Spagna', 'Francia'], 
  answer: 'Francia' },
  //32 domanda
  { question: 'Chi erano i flagellanti?', 
  options: ['Si frustavano in pubblico', 'Correvano per la città', 'Malati di peste', 'Fuggivano'], 
  answer: 'Si frustavano in pubblico' },
  //33 domanda
  { question: 'Chi era il sovrano d\'Inghilterra all\'inizio della Guerra dei Cent\'anni?', 
  options: ['Edoardo III', 'Riccardo II', 'Enrico V', 'Giovanni II'], 
  answer: 'Edoardo III' },
  //34 domanda
  { question: 'Quale città NON era tra le più grandi d\'Europa nel XIV secolo?', 
  options: ['Londra', 'Napoli', 'Berlino', 'Parigi'], 
  answer: 'Berlino' },
  //35 domanda
  { question: 'Quale figura storica fu associata alla fine della Guerra dei Cent\'anni?', 
  options: ['Giovanna d\'Arco', 'Federico II', 'Carlo Magno', 'Cosimo de\' Medici'], 
  answer: 'Giovanna d\'Arco' },
  //36 domanda
  { question: 'Quale fra questi elementi NON era una misura adottata contro la peste?',
   options: ['Lazzaretti', 'Divieto di commercio', 'Sterminio delle api', 'Uso di maschere'], 
   answer: 'Sterminio delle api' },
   //37 domanda
  { question: 'Quale fra questi NON fu una conseguenza della Peste Nera?', 
  options: ['Mobilità sociale', 'Crisi del feudalesimo', 'Incremento demografico', 'Richiesta di manodopera'], 
  answer: 'Incremento demografico' },
  //38 domanda
  { question: 'Cosa accade alla popolazione europea nel XIV secolo?', 
  options: ['Crescita', 'Stasi', 'Drastica diminuzione', 'Urbanizzazione'], 
  answer: 'Drastica diminuzione' },
  //39 domanda
  { question: 'Chi erano i beccamorti?', 
  options: ['Coloro che raccoglievano i cadaveri', 'Medici', 'Preti', 'Ufficiali'], 
  answer: 'Coloro che raccoglievano i cadaveri' },
  //40 domanda
  { question: 'Cosa significava la bandiera gialla su una casa?', 
  options: ['Contagiati', 'Medici presenti', 'Famiglia ricca', 'Casa abbandonata'], 
  answer: 'Contagiati' },
  //41 domanda
  { question: 'Perché la peste si diffuse rapidamente nei porti?', 
  options: ['Per il commercio marittimo', 'Per la povertà', 'Per le fogne', 'Per i marinai malati'], 
  answer: 'Per il commercio marittimo' },
  //42 domanda
  { question: 'Quale funzione avevano le campane durante la peste?', 
  options: ['Segnalare morti', 'Chiamare a raccolta', 'Allontanare spiriti', 'Riconoscere i guariti'], 
  answer: 'Segnalare morti' },
  //43 domanda
  { question: 'Quale fu la causa della crisi agricola del 1315-1317?', 
  options: ['Piogge incessanti', 'Guerra', 'Scioperi', 'Inflazione'], 
  answer: 'Piogge incessanti' },
  // 44 domanda
  { question: 'Qual era il principale mezzo di trasporto del contagio?', 
  options: ['Navi', 'Cavalli', 'Carrozze', 'Pellegrini'], 
  answer: 'Navi' },
  //45 domanda
  { question: 'Perché la medicina medievale fu inefficace contro la peste?', 
  options: ['Ignorava la vera causa', 'Era troppo cara', 'Non era diffusa', 'Usava troppe erbe'], 
  answer: 'Ignorava la vera causa' },
  //46 domanda
  { question: 'Cosa simboleggiava il colore nero nella peste?', 
  options: ['Morte', 'Speranza', 'Ricchezza', 'Potere'], 
  answer: 'Morte' },
  //47 domanda
  { question: 'Dove si trovavano spesso i lazzaretti?', 
  options: ['Fuori città', 'Al centro città', 'In conventi', 'In mercati'], 
  answer: 'Fuori città' },
  //48 domanda
  { question: 'Qual era uno dei sintomi tipici della peste bubbonica?',
   options: ['Bubboni', 'Tosse', 'Cecità', 'Febbre lieve'], 
   answer: 'Bubboni' },
   //49 domanda 
  { question: 'Cosa accadde all\'arte durante la peste?', 
  options: ['Si oscurò', 'Si fermò', 'Divenne allegra', 'Si concentrò sul paesaggio'], 
  answer: 'Si oscurò' },
  //50 domanda
  { question: 'Quale cambiamento culturale fu favorito dalla Peste Nera?',
    options: ['Declino della fede religiosa', 'Maggiore diffusione dell\'arte funeraria', 'Crescita del pensiero umanistico', 'Espansione dei monasteri'],
    answer: 'Crescita del pensiero umanistico' }
]

const categories = [
  "cell", // Cell effect
  "question", // [SPECIAL] Question
  "death", // [SPECIAL] Death
  "bonus", // [SPECIAL] Bonus
];

const weights = [
  45, // Weight for "cell"
  30, // Weight for "questions"
  10, // Weight for "death"
  15, // Weight for "bonus"
];

function weightedRandomCategory(categories, weights) {
  const totalWeight = weights.reduce((acc, val) => acc + val, 0);
  let r = Math.random() * totalWeight;
  for (let i = 0; i < categories.length; i++) {
    if (r < weights[i]) return i;
    r -= weights[i];
  }
  return categories.length - 1; // fallback
}

export function generateEffects(totalCells = 63) {
  //#region Global
  // Global Settings
  const alwaysExcludedCount = 2; // Cells that are always exluded (cell 1 and cell 63)
  const maxEffects = 35;

  // Global Vars
  let appliedEffects = 0; // Number of effects already applied
  const availableCells = totalCells - alwaysExcludedCount;
  const categoryCounts = [0, 0, 0, 0, 0]; // Track how many times each category is applied
  const excludedCells = new Set([1, totalCells]); // Excluded cells + already used cells
  const finalEffect = {};
  //#endregion
  // Question effect Settings
  const minQuestions = 3,
    maxQuestions = 6;

  // Cell effect Settings
  const cellEffectRange = 6; // Max signed movement for cell effect

  for (let i = 1; i < totalCells; ++i) {
    finalEffect[i] = { type: "empty" };
  }

  finalEffect[0] = { type: "start" };
  finalEffect[totalCells] = { type: "final" };

  // Question pool setup outside while loop (only once)
  let shuffledQuestions = [...questions].sort(() => 0.5 - Math.random());
  let questionIndex = 0;

  while (appliedEffects < maxEffects) {
    // While we haven't already applied effects to all possible cells
    // Choose weighted effect category
    const chosenEffectIndex = weightedRandomCategory(categories, weights);
    const chosenCategory = categories[chosenEffectIndex];

    const cell = Math.floor(Math.random() * availableCells) + 2;

    if (excludedCells.has(cell)) continue;

    if (chosenCategory === "cell") {
      const move =
        Math.floor(Math.random() * (cellEffectRange * 2 + 1)) - cellEffectRange;
      if (!move) continue;

      const target = cell + move;
      if (target < 1 || target >= totalCells) continue;

      finalEffect[cell] = { type: "cell", move };
    } else if (chosenCategory === "question") {
      const numQuestions =
        Math.floor(Math.random() * (maxQuestions - minQuestions + 1)) +
        minQuestions;
      const quests = {};
      // Iterate trough chosen question count
      for (let i = 0; i < numQuestions; ++i) {
        // If we exhausted the pool, reshuffle and reset
        if (questionIndex >= shuffledQuestions.length) {
          shuffledQuestions = [...questions].sort(() => 0.5 - Math.random());
          questionIndex = 0;
        }

        quests[i] = shuffledQuestions[questionIndex];
        questionIndex++;
      }

      finalEffect[cell] = { type: "question", quests };
    } else if (chosenCategory === "death") {
      finalEffect[cell] = { type: "death" };
    } else if (chosenCategory === "bonus") {
      finalEffect[cell] = { type: "bonus" };
    }

    excludedCells.add(cell);
    categoryCounts[chosenEffectIndex]++;
    appliedEffects++;
  }

  return finalEffect;
}
